id: commenti
label: ilDeposito commenti migration
migration_group: ilDeposito

source:
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: json
  urls: modules/custom/migrando/files/download_commenti.json
  item_selector: items
  fields:
    -
      name: cid
      selector: cid
    -
      name: uuid
      selector: uuid
    -
      name: pid
      selector: pid
    -
      name: entity_id
      selector: nid
    -
      name: subject
      selector: titolo
    -
      name: uid
      selector: uid
    -
      name: name
      selector: name
    -
      name: mail
      selector: email
    -
      name: homepage
      selector: homepage
    -
      name: hostname
      selector: hostname
    -
      name: created
      selector: created
    -
      name: changed
      selector: changed
    -
      name: thread
      selector: thread
    -
      name: entity_type
      selector: content_type
    -
      name: comment_body
      selector: testo
    -

  ids:
    cid:
      type: string

process:
  #cid: cid
  uuid: uuid
  comment_type:
    plugin: default_value
    default_value: comment
  langcode:
    plugin: default_value
    default_value: it
  pid:
    plugin: migration
    migration: commenti
    source: pid
  ## id multipli!!!!!#
  entity_id: entity_id
  subject:
    plugin: encode
    source: subject
  uid:
    plugin: migration
    migration: utenti
    source: uid
  name:
    plugin: encode
    source: name
  mail: mail
  homepage: homepage
  hostname: hostname
  created: created
  changed: changed
  status:
    plugin: default_value
    default_value: 1
  thread: thread
  entity_type:
    plugin: default_value
    default_value: node
  field_name:
    plugin: default_value
    default_value: field_commenti
  'comment_body/value': testo
  'comment_body/format':
    plugin: default_value
    ## VERIFICARE FILTRO HTML!
    default_value: basic_html

destination:
  plugin: entity:comment
  bundle: comment

dependencies:
  enforced:
    module:
      - migrando